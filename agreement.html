<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>합의서 작성 및 결제 - SafeSettlement</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="agreement.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&family=Nanum+Myeongjo:wght@700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <div class="dashboard-layout">
        <!-- Sidebar (Reused) -->
        <aside class="sidebar">
            <a href="index.html" class="logo">SafeSettlement.</a>
            <nav class="nav-links">
                <div class="nav-item" onclick="location.href='dashboard.html'">
                    <i class="fas fa-chart-pie"></i>
                    <span>사건 현황</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-comments"></i>
                    <span>안심 채팅</span>
                </div>
                <div class="nav-item active">
                    <i class="fas fa-file-signature"></i>
                    <span>합의서 관리</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-gavel"></i>
                    <span>변호사 중재</span>
                </div>
                <div style="flex: 1;"></div>
                <div class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>로그아웃</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-bar">
                <div>
                    <h2 style="margin-bottom: 5px;">합의서 작성 및 결제</h2>
                    <p style="color: var(--text-muted);">최종 합의 내용 확인 후 서명을 진행해주세요.</p>
                </div>
            </div>

            <div class="agreement-container">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active">1. 내용 확인</div>
                    <div class="step-line"></div>
                    <div class="step">2. 전자 서명</div>
                    <div class="step-line"></div>
                    <div class="step">3. 에스크로 결제</div>
                </div>

                <div class="two-column-layout">
                    <!-- Document Preview -->
                    <div class="document-viewer">
                        <div class="paper-doc">
                            <h1 style="text-align: center; font-family: 'Nanum Myeongjo', serif; margin-bottom: 30px;">형
                                사 합 의 서</h1>

                            <p class="doc-text">
                                <strong>피해자 (갑):</strong> 홍길동 (800101-1******)<br>
                                <strong>가해자 (을):</strong> 김철수 (820505-1******)
                            </p>

                            <p class="doc-text">
                                위 당사자들은 <strong>2024형제12345 폭행 사건</strong>에 관하여 다음과 같이 원만히 합의한다.
                            </p>

                            <ol class="doc-list">
                                <li>
                                    "을"은 "갑"에게 본 사건의 피해보상금으로 <strong>금 삼백오십만 원 (\3,500,000)</strong>을 지급한다.
                                    지급은 본 플랫폼의 에스크로 계좌를 통해 이루어지며, 입금 확인 즉시 본 합의서의 효력이 발생한다.
                                </li>
                                <li>
                                    "갑"은 본 합의금을 수령함과 동시에 "을"의 처벌을 원하지 않는다는 의사를 표시하며,
                                    향후 본 사건과 관련하여 민/형사상 어떠한 이의도 제기하지 않는다.
                                </li>
                                <li>
                                    양 당사자는 본 사건과 관련된 사실을 제3자에게 유포하거나 상대방을 비방하지 않을 것을 약속한다.
                                </li>
                            </ol>

                            <div class="doc-footer" style="margin-top: 50px; text-align: center;">
                                <p>2026년 1월 2일</p>
                                <br>
                                <div style="display: flex; justify-content: space-around;">
                                    <div>위 피해자(갑): <span id="sign-place-1" style="color:red;">(서명 대기)</span></div>
                                    <div>위 가해자(을): <span id="sign-place-2" style="font-weight:bold;">김철수 (인)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions Area -->
                    <div class="action-panel">
                        <div class="glass-card">
                            <h3>전자 서명</h3>
                            <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">
                                아래 영역에 마우스나 터치로 서명해주세요.
                            </p>

                            <canvas id="signaturePad" width="300" height="150"
                                style="background: white; border-radius: 8px; cursor: crosshair; touch-action: none;"></canvas>

                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button class="btn btn-glass" id="clearSignBtn"
                                    style="font-size: 0.8rem; padding: 0.5rem;">지우기</button>
                                <button class="btn btn-primary" id="confirmSignBtn" style="flex: 1;">서명 확정</button>
                            </div>
                        </div>

                        <div class="glass-card show-payment"
                            style="margin-top: 20px; opacity: 0.5; pointer-events: none;" id="paymentCard">
                            <h3>결제 (Escrow)</h3>
                            <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px;">
                                합의금: <strong>3,500,000원</strong>
                            </p>
                            <div class="payment-methods">
                                <div class="method selected"><i class="fas fa-university"></i> 가상계좌</div>
                                <div class="method"><i class="far fa-credit-card"></i> 카드결제</div>
                            </div>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" id="payBtn">입금 요청
                                (에스크로)</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- PDF Generation Modal (Mock) -->
    <div id="pdfModal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center;">
        <div
            style="background: white; width: 400px; padding: 30px; border-radius: 12px; text-align: center; color: #333;">
            <div id="pdfLoading">
                <i class="fas fa-file-pdf fa-3x" style="color: #e74c3c; margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px;">합의서 생성 중...</h3>
                <p style="color: #666; font-size: 0.9rem;">전자 서명과 타임스탬프(TSA)를<br>문서에 날인하고 있습니다.</p>
                <div
                    style="width: 100%; background: #eee; height: 6px; border-radius: 3px; margin-top: 20px; overflow: hidden;">
                    <div
                        style="width: 0%; height: 100%; background: var(--secondary); animation: progress 2s ease-in-out forwards;">
                    </div>
                </div>
            </div>
            <div id="pdfSuccess" style="display: none;">
                <i class="fas fa-check-circle fa-3x" style="color: var(--secondary); margin-bottom: 20px;"></i>
                <h3 style="margin-bottom: 10px;">발급 완료</h3>
                <p style="color: #666; font-size: 0.9rem; margin-bottom: 20px;">문서가 안전하게 저장되었습니다.</p>
                <button class="btn btn-primary" onclick="downloadMockPDF()">
                    <i class="fas fa-download"></i> PDF 다운로드 (240KB)
                </button>
                <button class="btn btn-glass"
                    style="margin-top: 10px; color: #666; width: 100%; border: 1px solid #ddd;"
                    onclick="closePdfModal()">닫기</button>
            </div>
        </div>
    </div>

    <style>
        @keyframes progress {
            0% {
                width: 0%;
            }

            100% {
                width: 100%;
            }
        }
    </style>

    <script src="agreement.js"></script>
</body>

</html>