<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - SafeHappE</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <section class="hero" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div class="glow-bg"></div>

        <div class="auth-box glass-card">
            <div style="text-align: center; margin-bottom: 30px;">
                <a href="index.html" style="text-decoration: none;">
                    <h2 style="margin-bottom: 10px;">
                        <span style="font-family: 'Outfit', sans-serif; font-weight: 800; color: #fff;">Safe<span
                                style="background: linear-gradient(135deg, #4ade80, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">HappE.</span></span>
                    </h2>
                    <div style="margin-top: -10px; margin-bottom: 5px;">
                        <span class="logo-sub-kr">세이프 <span class="highlight">합의</span></span>
                    </div>
                </a>
                <p style="color: var(--text-muted);">안전한 비대면 합의의 시작</p>
            </div>

            <!-- Login Form -->
            <div id="loginForm">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">이메일</label>
                        <input type="email" id="loginEmail" class="form-input" placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">비밀번호</label>
                        <input type="password" id="loginPw" class="form-input" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">로그인</button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">
                        계정이 없으신가요? <span onclick="toggleSignupMode(true)"
                            style="color: var(--secondary); cursor: pointer; font-weight: 600;">회원가입</span>
                    </p>
                </form>

                <!-- Signup Form (Hidden initially) -->
                <form id="signupForm" onsubmit="handleSignup(event)" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">이름</label>
                        <input type="text" id="regName" class="form-input" placeholder="홍길동" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">휴대폰 번호 (선택)</label>
                        <input type="tel" id="regPhone" class="form-input" placeholder="01012345678">
                        <small style="color: var(--text-muted); font-size: 0.8rem;">* 합의 요청 문자를 받으시려면 입력해주세요.</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">이메일</label>
                        <input type="email" id="regEmail" class="form-input" placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">비밀번호</label>
                        <input type="password" id="regPw" class="form-input" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="btn btn-primary"
                        style="width: 100%; margin-top: 10px; background: var(--secondary);">가입하기</button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">
                        이미 계정이 있으신가요? <span onclick="toggleSignupMode(false)"
                            style="color: var(--primary); cursor: pointer; font-weight: 600;">로그인</span>
                    </p>
                </form>

                <div class="divider">
                    <span>또는</span>
                </div>

                <button class="social-btn"><i class="fas fa-comment" style="margin-right:8px;"></i> 카카오로 시작하기</button>
            </div>
        </div>
    </section>

    <script>
        // API 설정
        const IS_LOCAL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const API_BASE = IS_LOCAL ? 'http://localhost:3000/api' : '/api';

        // 배포 시 정식 모드
        const DEMO_MODE = false;

        if (DEMO_MODE) {
            console.log('🎭 데모 모드로 실행 중 (백엔드 없음)');
        } else {
            console.log('🚀 정식 모드로 실행 중 (DB 저장)');
        }

        function toggleSignupMode(showSignup) {
            const loginForm = document.getElementById('loginForm').querySelector('form:not(#signupForm)');
            const signupForm = document.getElementById('signupForm');

            if (showSignup) {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            } else {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            }
        }

        // 1. Handle Signup
        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPw').value;
            const name = document.getElementById('regName').value;
            const phoneNumber = document.getElementById('regPhone').value;

            try {
                const res = await fetch(`${API_BASE}/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name, phoneNumber })
                });
                const data = await res.json();

                if (data.success) {
                    alert('가입이 완료되었습니다! 로그인해주세요.');
                    toggleSignupMode(false); // Switch to login
                } else {
                    alert('가입 실패: ' + data.error);
                }
            } catch (err) {
                alert('서버 연결 오류: ' + err.message);
                console.error(err);
            }
        }

        // 2. Handle Login
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPw').value;

            try {
                const res = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();

                if (data.success) {
                    // Save User Info
                    localStorage.setItem('user_id', data.userId);
                    localStorage.setItem('user_name', data.name);

                    alert(`${data.name}님 환영합니다!`);
                    location.href = 'dashboard.html';
                } else {
                    alert('로그인 실패: 이메일 또는 비밀번호를 확인하세요.');
                }
            } catch (err) {
                alert('서버 연결 오류. 서버가 실행 중인지 확인해주세요.');
                console.error(err);
            }
        }
    </script>
</body>

</html>