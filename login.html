<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ - SafeSettlement</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .switch-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            padding: 4px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .switch-btn {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-muted);
            transition: 0.3s;
        }

        .switch-btn.active {
            background: var(--bg-glass);
            color: var(--text-main);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .divider {
            display: flex;
            align-items: center;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin: 20px 0;
        }

        .divider::before,
        .divider::after {
            content: "";
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .divider span {
            padding: 0 10px;
        }

        .social-btn {
            width: 100%;
            padding: 12px;
            border-radius: var(--radius-sm);
            border: none;
            background: #FEE500;
            color: #191919;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <section class="auth-container">
        <div class="auth-box glass-card">
            <h2 style="margin-bottom: 10px;">SafeSettlement.</h2>
            <p style="color: var(--text-muted); margin-bottom: 30px;">ì•ˆì „í•˜ê³  ê³µì •í•œ í•©ì˜ë¥¼ ìœ„í•œ ì²« ê±¸ìŒ</p>



            <!-- Login / Signup Container -->
            <div id="form-auth-container">
                <!-- Login Form -->
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">ì´ë©”ì¼</label>
                        <input type="email" id="loginEmail" class="form-input" placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPw" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">ë¡œê·¸ì¸</button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">
                        ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? <span onclick="toggleSignupMode(true)"
                            style="color: var(--secondary); cursor: pointer; font-weight: 600;">íšŒì›ê°€ì…</span>
                    </p>
                </form>

                <!-- Signup Form (Hidden initially) -->
                <form id="signupForm" onsubmit="handleSignup(event)" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">ì´ë¦„</label>
                        <input type="text" id="regName" class="form-input" placeholder="í™ê¸¸ë™" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">íœ´ëŒ€í° ë²ˆí˜¸ (ì„ íƒ)</label>
                        <input type="tel" id="regPhone" class="form-input" placeholder="01012345678">
                        <small style="color: var(--text-muted); font-size: 0.8rem;">* í•©ì˜ ìš”ì²­ ë¬¸ìë¥¼ ë°›ìœ¼ì…¨ë‹¤ë©´ ì…ë ¥í•´ì£¼ì„¸ìš”.</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ì´ë©”ì¼</label>
                        <input type="email" id="regEmail" class="form-input" placeholder="example@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="regPw" class="form-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <!-- Role selection removed -->
                    <button type="submit" class="btn btn-primary"
                        style="width: 100%; margin-top: 10px; background: var(--secondary);">ê°€ì…í•˜ê¸°</button>
                    <p style="margin-top: 15px; font-size: 0.9rem; color: var(--text-muted);">
                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <span onclick="toggleSignupMode(false)"
                            style="color: var(--primary); cursor: pointer; font-weight: 600;">ë¡œê·¸ì¸</span>
                    </p>
                </form>

                <div class="divider">
                    <span>ë˜ëŠ”</span>
                </div>

                <button class="social-btn"><i class="fas fa-comment" style="margin-right:8px;"></i> ì¹´ì¹´ì˜¤ë¡œ ì‹œì‘í•˜ê¸°</button>
            </div>

            <!-- Verify Form (Hidden by default) -->


        </div>
    </section>

    <script>
        // API ì„¤ì •
        const IS_LOCAL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        // ë°°í¬ í™˜ê²½ê³¼ ë¡œì»¬(ì„œë²„ ì‹¤í–‰) í™˜ê²½ ëª¨ë‘ ìƒëŒ€ ê²½ë¡œ '/api'ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
        // ë‹¨, VSCode Live Server ë“±ìœ¼ë¡œ ì—´ì—ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ë¡œì»¬ì´ë©´ ì „ì²´ ê²½ë¡œë¥¼ ì”ë‹ˆë‹¤.
        const API_BASE = IS_LOCAL ? 'http://localhost:3000/api' : '/api';

        // ì •ì‹ ëª¨ë“œ ì „í™˜: API ì„œë²„ê°€ ìˆìœ¼ë©´ ë°ëª¨ ëª¨ë“œë¥¼ ë•ë‹ˆë‹¤.
        // ë°°í¬ í™˜ê²½(Render)ì—ì„œëŠ” ë°±ì—”ë“œê°€ ì‹¤í–‰ë˜ë¯€ë¡œ DEMO_MODE = falseë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
        const DEMO_MODE = false;

        if (DEMO_MODE) {
            console.log('ğŸ­ ë°ëª¨ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ (ë°±ì—”ë“œ ì—†ìŒ)');
        } else {
            console.log('ğŸš€ ì •ì‹ ëª¨ë“œë¡œ ì‹¤í–‰ ì¤‘ (DB ì €ì¥)');
        }



        function toggleSignupMode(showSignup) {
            const loginForm = document.getElementById('loginForm');
            const signupForm = document.getElementById('signupForm');

            if (showSignup) {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            } else {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            }
        }

        // 1. Handle Signup
        async function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPw').value;
            const name = document.getElementById('regName').value;
            // Role removed
            const phoneNumber = document.getElementById('regPhone').value;

            if (DEMO_MODE) {
                // ë°ëª¨ ëª¨ë“œ: localStorageì— ì €ì¥
                const userId = Date.now(); // ê°„ë‹¨í•œ ID ìƒì„±
                localStorage.setItem('demo_user', JSON.stringify({ userId, email, name, phoneNumber }));
                alert('âœ… ë°ëª¨ ëª¨ë“œ: ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                toggleSignupMode(false);
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/signup`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name, phoneNumber })
                });
                const data = await res.json();

                if (data.success) {
                    alert('ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
                    toggleSignupMode(false); // Switch to login
                } else {
                    alert('ê°€ì… ì‹¤íŒ¨: ' + data.error);
                }
            } catch (err) {
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ' + err.message + '\n\n[í•´ê²° ë°©ë²•]\n1. Node.jsê°€ ì„¤ì¹˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.\n2. í„°ë¯¸ë„ì—ì„œ "node server.js"ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
                console.error(err);
            }
        }

        // 2. Handle Login
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPw').value;

            if (DEMO_MODE) {
                // ë°ëª¨ ëª¨ë“œ: localStorageì—ì„œ í™•ì¸
                const demoUser = JSON.parse(localStorage.getItem('demo_user') || 'null');
                if (demoUser && demoUser.email === email) {
                    localStorage.setItem('user_id', demoUser.userId);
                    localStorage.setItem('user_name', demoUser.name);
                    // Role removed
                    alert(`âœ… ë°ëª¨ ëª¨ë“œ: ${demoUser.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.`);
                    location.href = 'dashboard.html';
                } else {
                    alert('âŒ ë°ëª¨ ëª¨ë“œ: ë¨¼ì € íšŒì›ê°€ì…ì„ í•´ì£¼ì„¸ìš”.');
                }
                return;
            }

            try {
                const res = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();

                if (data.success) {
                    // Save User Info
                    localStorage.setItem('user_id', data.userId);
                    localStorage.setItem('user_name', data.name);
                    // Role removed

                    alert(`${data.name}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤.`);
                    location.href = 'dashboard.html';
                } else {
                    alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                }
            } catch (err) {
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                console.error(err);
            }
        }


    </script>
</body>

</html>