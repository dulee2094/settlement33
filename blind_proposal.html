<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>釉붾씪?몃뱶 ?⑹쓽 ?쒖븞 - SafeHappE</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <a href="index.html" class="logo">SafeHappE.</a>
            <nav class="nav-links">
                <div class="nav-item active" onclick="location.href='dashboard.html'">
                    <i class="fas fa-chart-pie"></i>
                    <span>?ш굔 ?꾪솴 (釉붾씪?몃뱶)</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-comments"></i>
                    <span>?덉떖 梨꾪똿</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-file-signature"></i>
                    <span>?⑹쓽??愿由?/span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-gavel"></i>
                    <span>蹂?몄궗 以묒옱</span>
                </div>
                <div style="flex: 1;"></div>
                <div class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>濡쒓렇?꾩썐</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="top-bar">
                <div>
                    <h2 style="margin-bottom: 5px;">釉붾씪?몃뱶 ?⑹쓽 ?쒖븞</h2>
                    <p style="color: var(--text-muted);">媛먯젙 ?뚮え ?놁씠 ?щ쭩 湲덉븸??議곗쑉?대낫?몄슂.</p>
                </div>
                <div style="display: flex; gap: 15px; align-items: center;">
                    <button class="btn btn-glass" style="font-size: 0.85rem;" onclick="location.href='dashboard.html'">
                        <i class="fas fa-arrow-left" style="margin-right: 6px;"></i> ?ㅻ줈媛湲?
                    </button>
                    <span class="status-badge" id="statusBadge"
                        style="background: var(--bg-card); color: var(--text-muted);">?쒖븞 ?湲곗쨷</span>
                </div>
            </div>

            <!-- Blind Proposal Section -->
            <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr;">

                <!-- Left: My Proposal -->
                <div class="glass-card" style="height: 100%;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                        <h3>?섏쓽 ?щ쭩 湲덉븸</h3>
                        <span
                            style="font-size: 0.8rem; padding: 4px 10px; background: rgba(255,255,255,0.1); border-radius: 12px;">鍮꾧났媛?
                            ?덉쟾 蹂댁옣 <i class="fas fa-lock s"></i></span>
                    </div>

                    <div style="text-align: center; margin-bottom: 40px;">
                        <p style="color: var(--text-muted); margin-bottom: 10px;">?곷?諛⑹뿉寃?援ъ껜?곸씤 湲덉븸???몄텧?섏? ?딆뒿?덈떎.</p>
                        <div style="position: relative; max-width: 300px; margin: 0 auto;">
                            <span
                                style="position: absolute; right: 25px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; color: var(--text-muted); font-weight: bold;">留뚯썝</span>
                            <input type="number" id="myAmount" class="form-input"
                                style="padding-right: 70px; font-size: 1.5rem; font-weight: bold; text-align: center;"
                                placeholder="0">
                        </div>
                        <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">* ?? 300留뚯썝 ?낅젰 ??300留??낅젰</p>
                    </div>

                    <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 15px;"><i class="fas fa-balance-scale"></i> AI 遺꾩꽍 媛?대뱶</h4>
                        <ul
                            style="font-size: 0.9rem; color: var(--text-muted); text-align: left; list-style: disc; padding-left: 20px;">
                            <li>?좎궗 ?먮? ?됯퇏: <strong>350留뚯썝 ~ 400留뚯썝</strong></li>
                            <li>?덈Т ??? 湲덉븸? ?곷?諛⑹쓽 嫄곕?媛먯쓣 ?좊컻?????덉뒿?덈떎.</li>
                        </ul>
                    </div>

                    <button class="btn btn-primary" style="width: 100%;" onclick="submitProposal()">?쒖븞 ?깅줉?섍린</button>
                </div>

                <!-- Right: Gap Analysis Result -->
                <div class="glass-card"
                    style="height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">

                    <div id="waitingState">
                        <div style="font-size: 4rem; color: var(--text-muted); margin-bottom: 20px; opacity: 0.3;">
                            <i class="fas fa-user-secret"></i>
                        </div>
                        <h3>?곷?諛⑹쓽 ?쒖븞??湲곕떎由ш퀬 ?덉뒿?덈떎</h3>
                        <p style="color: var(--text-muted); margin-top: 10px;">?묒륫 紐⑤몢 ?쒖븞???깅줉?섎㈃<br>湲덉븸 李⑥씠(Gap) 踰붿쐞留??뚮젮?쒕┰?덈떎.
                        </p>
                    </div>

                    <div id="resultState" style="display: none; width: 100%;">
                        <div style="margin-bottom: 30px;">
                            <span style="font-size: 0.9rem; color: var(--secondary);">遺꾩꽍 ?꾨즺</span>
                            <h2 style="font-size: 2rem; margin-top: 10px;" id="gapTitle">湲덉븸 李⑥씠媛 ?쎈땲??/h2>
                        </div>

                        <!-- Gauge Visual -->
                        <div
                            style="width: 100%; height: 20px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-bottom: 30px; position: relative;">
                            <div id="gapGauge"
                                style="width: 80%; height: 100%; background: linear-gradient(90deg, #ff4d4d, #f9cb28); border-radius: 10px; transition: width 1s ease;">
                            </div>

                            <!-- Markers -->
                            <div style="position: absolute; left: 20%; top: 25px; font-size: 0.7rem; color: #aaa;">|
                                100留??대궡</div>
                            <div style="position: absolute; left: 50%; top: 25px; font-size: 0.7rem; color: #aaa;">|
                                500留??대궡</div>
                            <div style="position: absolute; left: 80%; top: 25px; font-size: 0.7rem; color: #aaa;">|
                                1000留??댁긽</div>
                        </div>

                        <p style="color: var(--text-muted); line-height: 1.6; margin-bottom: 30px;" id="gapDesc">
                            ?묒륫???섍껄 李⑥씠媛 <strong>500留뚯썝 ~ 1000留뚯썝</strong> ?ъ씠?낅땲??<br>
                            吏곸젒?곸씤 ??붾낫?ㅻ뒗 ?꾨Ц媛??以묒옱瑜?怨좊젮?대낫?쒕뒗 寃껋씠 醫뗭뒿?덈떎.
                        </p>

                        <div id="actionButtons">
                            <button class="btn btn-glass" style="margin-right: 10px;">湲덉븸 ?섏젙 ?쒖븞</button>
                            <button class="btn btn-primary"
                                style="background: linear-gradient(135deg, #FF6B6B, #FF8E53);">蹂?몄궗 以묒옱 ?좎껌</button>
                        </div>
                    </div>

                </div>

            </div>

            <!-- Proposal History Section -->
            <div class="glass-card" style="margin-top: 20px;">
                <h3 style="margin-bottom: 20px;"><i class="fas fa-history"></i> ?쒖븞 ?덉뒪?좊━</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; text-align: left;">
                        <thead>
                            <tr style="border-bottom: 1px solid rgba(255,255,255,0.1); color: var(--text-muted);">
                                <th style="padding: 15px; font-weight: 500;">?뚯감</th>
                                <th style="padding: 15px; font-weight: 500;">?쇱떆</th>
                                <th style="padding: 15px; font-weight: 500;">?섏쓽 ?쒖븞 (??</th>
                                <th style="padding: 15px; font-weight: 500;">遺꾩꽍 寃곌낵</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <tr>
                                <td colspan="4" style="padding: 30px; text-align: center; color: var(--text-muted);">
                                    ?꾩쭅 ?쒖븞 ?댁뿭???놁뒿?덈떎.
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Proposal History State
        let proposalHistory = [];
        let proposalCount = 0;

        // Mock function to simulate Blind Gap Logic - 5 Level System + Man-won Unit + Over-offer Check
        function submitProposal() {
            const rawInput = parseInt(document.getElementById('myAmount').value);
            if (!rawInput) return alert('?щ쭩 湲덉븸???낅젰?댁＜?몄슂.');

            // Convert Man-won to Won
            const myAmount = rawInput * 10000;

            const btn = document.querySelector('.btn-primary');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 遺꾩꽍以?..';
            btn.disabled = true;

            // Simulate Server Delay and Victim's Hidden Amount
            setTimeout(() => {
                // Scenario: Victim wants 800 Man-won.
                const victimAmount = 8000000;

                // Logic Update 1: Check for Over-offer (User offers MORE than Victim wants)
                let isOverOffer = false;
                if (myAmount >= victimAmount) {
                    isOverOffer = true;
                }

                const diff = Math.abs(victimAmount - myAmount);
                const average = (victimAmount + myAmount) / 2;
                let gapPercent = (diff / average) * 100;

                // Exception for small amounts
                if (diff <= 500000) gapPercent = 0;

                // Forced Level 1 if Over-offer
                if (isOverOffer) {
                    gapPercent = 0; // Force to 0% gap logic
                }

                document.getElementById('waitingState').style.display = 'none';
                document.getElementById('resultState').style.display = 'block';

                const gapTitle = document.getElementById('gapTitle');
                const gapDesc = document.getElementById('gapDesc');
                const gapGauge = document.getElementById('gapGauge');

                const statusBadge = document.getElementById('statusBadge');
                const actionButtons = document.getElementById('actionButtons');

                // Determine Level
                let level = 0;
                let color = '';
                let title = '';
                let desc = '';
                let width = '';
                let badgeText = '';

                if (gapPercent <= 10) {
                    // Level 1: Green Zone (Including Over-offer)
                    level = 1;
                    color = '#4ade80'; // Green

                    if (isOverOffer) {
                        title = "利됱떆 ?⑹쓽媛 媛?ν빀?덈떎!";
                        desc = `?쒖븞?섏떊 湲덉븸???곷?諛⑹쓽 湲곕?移섎? 異⑹”?⑸땲??<br>吏湲?諛붾줈 ?⑹쓽瑜?吏꾪뻾?섏뀛??醫뗭뒿?덈떎.`;
                    } else {
                        title = "異뺥븯?⑸땲?? ?⑹쓽 ?깆궗 吏곸쟾?낅땲??;
                        desc = `?묒륫???쒖븞 湲덉븸 李⑥씠媛 <strong>10% ?대궡</strong>(??${diff.toLocaleString()}???낅땲??<br>?ъ떎???⑹쓽媛 ?깆궗???곹깭?대ŉ, ?꾩＜ 議곌툑留???諛곕젮?섎㈃ 利됱떆 ?寃곕맗?덈떎.`;
                    }

                    width = '98%'; // Max full
                    badgeText = '?깆궗 ?뺤떎';
                    actionButtons.innerHTML = '<button class="btn btn-primary" style="background: #4ade80; color: #000;">吏湲?諛붾줈 ?⑹쓽?섍린</button>';
                } else if (gapPercent <= 30) {
                    // Level 2: Blue Zone
                    level = 2;
                    color = '#3b82f6'; // Blue
                    title = "湲띿젙??議곗쑉 ?④퀎?낅땲??;
                    desc = `?쒕줈???섍껄 李⑥씠媛 <strong>?ъ? ?딆뒿?덈떎.</strong><br>?덉떖 梨꾪똿???듯빐 援ъ껜?곸씤 ?ъ젙???ㅻ챸?섎㈃ 異⑸텇??媛꾧레??醫곹옄 ???덉뒿?덈떎.`;
                    width = '75%';
                    badgeText = '議곗쑉 媛??;
                    actionButtons.innerHTML = '<button class="btn btn-glass" style="margin-right: 10px;">?섏젙 ?쒖븞?섍린</button><button class="btn btn-primary">?덉떖 梨꾪똿諛??닿린</button>';
                } else if (gapPercent <= 60) {
                    // Level 3: Yellow Zone
                    level = 3;
                    color = '#facc15'; // Yellow
                    title = "?꾨Ц媛??以묒옱媛 ?꾩슂?⑸땲??;
                    desc = `?쒓컖 李⑥씠媛 ?ㅼ냼 ?쎈땲?? 媛쒖씤 媛꾩쓽 ??붾줈??媛먯젙???곹븷 ???덉뒿?덈떎.<br><strong>蹂?몄궗 以묒옱</strong>??<strong>AI ?먮? 遺꾩꽍</strong> 由ы룷?몃? 李멸퀬?섏꽭??`;
                    width = '50%';
                    badgeText = '以묒옱 沅뚯옣';
                    actionButtons.innerHTML = '<button class="btn btn-glass">?섏젙 ?쒖븞?섍린</button><button class="btn btn-primary" style="background: #facc15; color: #000;">蹂?몄궗 以묒옱 ?좎껌</button>';
                } else if (gapPercent <= 100) {
                    // Level 4: Orange Zone
                    level = 4;
                    color = '#fb923c'; // Orange
                    title = "?낆옣 李⑥씠媛 留ㅼ슦 ?쎈땲??;
                    desc = `?꾩옱 ?곹깭濡쒕뒗 ?⑹쓽媛 ?대졄?듬땲?? ?곷?諛⑹? 洹?섏? <strong>?꾪? ?ㅻⅨ 湲곗?</strong>??媛吏怨??덉뒿?덈떎.<br>?좎떆 ?됯컖湲곕? 媛吏??寃껋쓣 異붿쿇?⑸땲??`;
                    width = '25%';
                    badgeText = '?ш컖??寃⑹감';
                    actionButtons.innerHTML = '<button class="btn btn-glass">?쒖븞 蹂대쪟?섍린</button>';
                } else {
                    // Level 5: Red Zone
                    level = 5;
                    color = '#ef4444'; // Red
                    title = "?⑹쓽???꾩텧??遺덇??ν빐 蹂댁엯?덈떎";
                    desc = `媛꾧레???덈Т ?쎈땲??(100% ?댁긽 李⑥씠).<br>?ъ떎??寃곕젹 ?곹깭?낅땲?? ?뺤궗 議곗젙 ?덉감???뺤떇 ?ы뙋??以鍮꾪븯?쒕뒗 寃껋씠 ?⑥쑉?곸엯?덈떎.`;
                    width = '10%';
                    badgeText = '寃곕젹 ?꾧린';
                    actionButtons.innerHTML = '<button class="btn btn-primary" style="background: #ef4444;">?뺤궗 ?덉감 ?덈궡 蹂닿린</button>';
                }

                // Update UI Elements
                gapTitle.textContent = title;
                gapDesc.innerHTML = desc;

                // Animate Gauge
                gapGauge.style.width = width;
                gapGauge.style.background = color;
                gapGauge.style.boxShadow = `0 0 20px ${color}`;

                statusBadge.textContent = badgeText;
                statusBadge.style.color = color;
                statusBadge.style.background = 'rgba(255,255,255,0.05)';
                statusBadge.style.border = `1px solid ${color}`;

                // Add Range Hint (Blurring Effect)
                // Show a range like: (Target - 20%) ~ (Target + 20%)
                const minRange = Math.floor(victimAmount * 0.8 / 10000) * 10000;
                const maxRange = Math.ceil(victimAmount * 1.2 / 10000) * 10000;

                // Check if range hint element exists, if not create one
                let rangeElement = document.getElementById('rangeHintBox');
                if (!rangeElement) {
                    rangeElement = document.createElement('div');
                    rangeElement.id = 'rangeHintBox';
                    rangeElement.style.marginTop = '20px';
                    rangeElement.style.padding = '15px';
                    rangeElement.style.background = 'rgba(255,255,255,0.05)';
                    rangeElement.style.borderRadius = '8px';
                    // Insert before buttons
                    document.getElementById('resultState').insertBefore(rangeElement, actionButtons);
                }

                rangeElement.innerHTML = `
                    <div style="font-size: 0.85rem; color: #aaa; margin-bottom: 5px;">?곷?諛??쒖븞 ?덉긽 踰붿쐞</div>
                    <div style="font-size: 1.2rem; font-weight: bold; color: #fff; filter: blur(${level >= 4 ? '5px' : '0px'}); transition: filter 0.5s;">
                        ${minRange.toLocaleString()}??~ ${maxRange.toLocaleString()}??
                    </div>
                     ${level >= 4 ? '<div style="font-size:0.7rem; color:#ef4444; margin-top:5px;">寃⑹감媛 ?덈Т 而ㅼ꽌 踰붿쐞議곗감 ?먮┸?⑸땲??</div>' : ''}
                `;

                // Add to History
                proposalCount++;
                const now = new Date();
                const timeString = `${now.getMonth() + 1}/${now.getDate()} ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`;

                const historyItem = {
                    round: proposalCount,
                    time: timeString,
                    amount: myAmount,
                    result: badgeText,
                    color: color
                };

                proposalHistory.unshift(historyItem); // Add to top
                updateHistoryUI();

                btn.innerHTML = '?섏젙 ?쒖븞?섍린';
                btn.disabled = false;
                btn.classList.add('btn-glass');
                btn.classList.remove('btn-primary');
            }, 1000);
        }

        function updateHistoryUI() {
            const tbody = document.getElementById('historyTableBody');
            if (proposalHistory.length === 0) return;

            tbody.innerHTML = proposalHistory.map(item => `
                <tr style="border-bottom: 1px solid rgba(255,255,255,0.05);">
                    <td style="padding: 15px;">${item.round}李?/td>
                    <td style="padding: 15px; color: var(--text-muted); font-size: 0.9rem;">${item.time}</td>
                    <td style="padding: 15px; font-weight: bold;">${item.amount.toLocaleString()}</td>
                    <td style="padding: 15px;">
                        <span style="font-size: 0.8rem; padding: 4px 10px; border-radius: 12px; border: 1px solid ${item.color}; color: ${item.color}; background: rgba(255,255,255,0.05);">
                            ${item.result}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>

</html>