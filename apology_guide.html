<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ?ш낵臾??묒꽦 ?ㅽ뒠?붿삤 - SafeHappE</title>
    <link rel="stylesheet" href="style.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;700;800&family=Nanum+Myeongjo:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-light: rgba(74, 222, 128, 0.1);
        }

        .studio-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
        }

        @media (max-width: 1000px) {
            .studio-grid {
                grid-template-columns: 1fr;
                height: auto;
            }
        }

        .wizard-card {
            background: var(--bg-card);
            border: var(--border-glass);
            border-radius: var(--radius-md);
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            overflow-y: auto;
        }

        .editor-card {
            background: #fff;
            border-radius: var(--radius-md);
            padding: 40px;
            color: #333;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .paper-input {
            width: 100%;
            flex: 1;
            border: none;
            resize: none;
            font-family: 'Nanum Myeongjo', serif;
            padding-top: 5px;
        }

        .form-label {
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 8px;
            display: block;
        }

        .select-input,
        .text-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px;
            border-radius: 8px;
            outline: none;
        }

        .select-input option {
            background: #1a1a2e;
            color: white;
        }

        /* Custom Checkbox Styling */
        .check-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .custom-check {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: 0.2s;
        }

        .custom-check:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .custom-check input {
            display: none;
        }

        .check-indicator {
            width: 18px;
            height: 18px;
            border: 2px solid #555;
            border-radius: 4px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .custom-check input:checked+.check-indicator {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        .check-indicator::after {
            content: '??;
            color: #1a1a2e;
            font-size: 12px;
            font-weight: bold;
            display: none;
        }

        .custom-check input:checked+.check-indicator::after {
            display: block;
        }

        .custom-check span {
            font-size: 0.9rem;
            color: #ddd;
        }

        .select-input option {
            background: #1a1a2e;
            color: white;
        }

        .tone-selector {
            display: flex;
            gap: 10px;
        }

        .tone-option {
            flex: 1;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            background: rgba(255, 255, 255, 0.02);
            font-size: 0.9rem;
        }

        .tone-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .tone-option.selected {
            background: var(--primary-light);
            border-color: var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }

        .ref-item {
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
        }

        .ref-item:hover {
            background: rgba(255, 255, 255, 0.07);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .status-badge {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--secondary);
            margin-right: 8px;
            background: var(--secondary);
            margin-right: 8px;
        }
        }
    </style>
</head>

<body>

    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <a href="index.html" class="logo" style="font-size: 1.5rem;">AI ?묒꽦 ?꾩슦誘?/a>

            <nav class="nav-links" style="margin-top: 20px;">
                <!-- Studio Home / Wizard -->
                <div class="nav-item active" id="menuHome" onclick="showWizard()">
                    <i class="fas fa-layer-group"></i>
                    <span>?ㅽ뒠?붿삤 ??/span>
                </div>
                <div class="nav-item" id="menuDraft" onclick="showWizard()">
                    <i class="fas fa-magic"></i>
                    <span>AI 珥덉븞 ?앹꽦</span>
                </div>
                <div class="nav-item" id="menuRef" onclick="showReferences()">
                    <i class="fas fa-book-open"></i>
                    <span>?좏삎蹂??ш낵臾??덉떆</span>
                </div>

                <div
                    style="margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 20px; padding-top: 10px;">
                </div>

                <div class="nav-item" onclick="confirmReturn()">
                    <i class="fas fa-undo"></i>
                    <span>?뚯븘媛湲?(?묒꽦 痍⑥냼)</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content" style="overflow: hidden;">
            <div class="studio-grid">

                <!-- Left Panel Container -->
                <div class="wizard-card">

                    <!-- View 1: Wizard (Default) -->
                    <!-- View 1: Wizard (Default) -->
                    <div id="wizardPanel">
                        <h3 style="margin-bottom: 15px;"><i class="fas fa-robot"></i> AI ?묒꽦 ?ㅼ젙</h3>

                        <!-- 1. Basic Info -->
                        <div class="form-section" style="margin-bottom: 25px;">
                            <label class="form-label">1. 湲곕낯 ?뺣낫</label>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <div>
                                    <span style="font-size: 0.8rem; color: #999; display:block; margin-bottom:5px;">?ш굔
                                        ?좏삎</span>
                                    <select class="select-input" id="caseType">
                                        <option value="assault">??뻾/?곹빐</option>
                                        <option value="traffic">援먰넻?ш퀬</option>
                                        <option value="defamation">紐낆삁?쇱넀</option>
                                        <option value="fraud">湲덉쟾臾몄젣</option>
                                    </select>
                                </div>
                                <div>
                                    <span
                                        style="font-size: 0.8rem; color: #999; display:block; margin-bottom:5px;">愿怨?/span>
                                    <select class="select-input" id="relationship">
                                        <option value="acquaintance">吏??/option>
                                        <option value="stranger">珥덈㈃</option>
                                        <option value="coworker">吏곸옣?숇즺</option>
                                        <option value="friend">移쒓뎄</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- 2. Cause (Checkbox) -->
                        <div class="form-section" style="margin-bottom: 25px;">
                            <label class="form-label">2. ?ш굔 諛쒖깮 ?먯씤 (以묐났 ?좏깮 媛??</label>
                            <div class="check-group" id="causeGroup">
                                <label class="custom-check">
                                    <input type="checkbox" value="alcohol">
                                    <div class="check-indicator"></div>
                                    <span>?좉???痍⑥쨷 (?먮떒?????</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="anger">
                                    <div class="check-indicator"></div>
                                    <span>?쒓컙?곸씤 遺꾨끂/媛먯젙 議곗젅 ?ㅽ뙣</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="mistake">
                                    <div class="check-indicator"></div>
                                    <span>?ㅽ빐??李⑷컖?쇰줈 ?명븳 ?ㅼ닔</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="careless">
                                    <div class="check-indicator"></div>
                                    <span>遺二쇱쓽/?덉씪???앷컖</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="financial">
                                    <div class="check-indicator"></div>
                                    <span>寃쎌젣???대젮?/?앺솢怨?/span>
                                </label>
                            </div>
                        </div>

                        <!-- 3. Damage (Checkbox) -->
                        <div class="form-section" style="margin-bottom: 25px;">
                            <label class="form-label">3. ?쇳빐 ?댁슜 (以묐났 ?좏깮 媛??</label>
                            <div class="check-group" id="damageGroup">
                                <label class="custom-check">
                                    <input type="checkbox" value="physical">
                                    <div class="check-indicator"></div>
                                    <span>?좎껜???곹빐/?듭쬆</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="mental">
                                    <div class="check-indicator"></div>
                                    <span>?뺤떊??異⑷꺽/?몃씪?곕쭏</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="money">
                                    <div class="check-indicator"></div>
                                    <span>湲덉쟾???먯떎/李⑤웾 ?뚯넀</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="honor">
                                    <div class="check-indicator"></div>
                                    <span>紐낆삁 ?ㅼ텛/?섏튂??/span>
                                </label>
                            </div>
                        </div>

                        <!-- 4. Recovery & Promise (Checkbox) -->
                        <div class="form-section" style="margin-bottom: 25px;">
                            <label class="form-label">4. ?몃젰 諛??쎌냽</label>
                            <div class="check-group" id="effortGroup">
                                <label class="custom-check">
                                    <input type="checkbox" value="comp">
                                    <div class="check-indicator"></div>
                                    <span>?⑹쓽湲?諛곗긽/移섎즺鍮?吏湲?/span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="habit">
                                    <div class="check-indicator"></div>
                                    <span>?섎せ???듦? 媛쒖꽑(湲덉＜ ??</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="counsel">
                                    <div class="check-indicator"></div>
                                    <span>?곷떞/援먯쑁 ?댁닔</span>
                                </label>
                                <label class="custom-check">
                                    <input type="checkbox" value="delete">
                                    <div class="check-indicator"></div>
                                    <span>寃뚯떆湲 ??젣 諛??뺤젙</span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-top: 20px;">
                            <label class="form-label">?댁“ (Tone)</label>
                            <div class="tone-selector">
                                <div class="tone-option selected" onclick="selectTone(this, 'emotional')">
                                    <i class="fas fa-heart"></i><br>媛먯꽦???몄냼
                                </div>
                                <div class="tone-option" onclick="selectTone(this, 'formal')">
                                    <i class="fas fa-user-tie"></i><br>?뺤쨷/寃⑹떇
                                </div>
                            </div>
                        </div>


                        <button class="btn btn-primary" style="margin-top: 30px; width: 100%;"
                            onclick="generateDraft()">
                            <i class="fas fa-pen-fancy"></i> AI 珥덉븞 ?앹꽦?섍린
                        </button>
                    </div>

                    <!-- View 2: Reference Library (Hidden Default) -->
                    <div id="referencePanel" style="display: none;">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-book-open"></i> ?좏삎蹂??ш낵臾??덉떆</h3>
                        <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 20px;">
                            ?ш굔 ?좏삎蹂꾨줈 寃利앸맂 ?ш낵臾??덉떆瑜?李멸퀬?섏뿬 ???곹솴??留욊쾶 ?섏젙?대낫?몄슂.
                        </p>

                        <!-- Category: Assault -->
                        <div class="ref-category">
                            <h4
                                style="color: #4ade80; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                                <i class="fas fa-fist-raised"></i> ??뻾/?곹빐
                            </h4>
                            <div class="ref-item" onclick="applyExample('assault1')">
                                <h5>?곕컻????뻾 (?좎옄由???</h5>
                                <p style="font-size: 0.8rem; color: #999;">?쒓컙??媛먯젙??李몄? 紐삵븯怨?..</p>
                            </div>
                            <div class="ref-item" onclick="applyExample('assault2')">
                                <h5>?곹빐 ?쇳빐 諛쒖깮 (?꾩튂)</h5>
                                <p style="font-size: 0.8rem; color: #999;">移섎즺媛 ?꾩슂???곸쿂瑜??낇엺 ??..</p>
                            </div>
                        </div>

                        <!-- Category: Defamation -->
                        <div class="ref-category" style="margin-top: 20px;">
                            <h4
                                style="color: #ff6b6b; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                                <i class="fas fa-bullhorn"></i> 紐⑥슃/紐낆삁?쇱넀
                            </h4>
                            <div class="ref-item" onclick="applyExample('defam1')">
                                <h5>?⑤씪???볤?/寃뚯떆湲</h5>
                                <p style="font-size: 0.8rem; color: #999;">?듬챸???ㅼ뿉 ?⑥뼱 ?곸쿂瑜?..</p>
                            </div>
                            <div class="ref-item" onclick="applyExample('defam2')">
                                <h5>?⑦넚諛???諛쒖뼵</h5>
                                <p style="font-size: 0.8rem; color: #999;">?щ읉???덈뒗 怨듦컙?먯꽌 寃쎌넄?섍쾶...</p>
                            </div>
                        </div>

                        <!-- Category: Traffic -->
                        <div class="ref-category" style="margin-top: 20px;">
                            <h4
                                style="color: #f9cb28; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                                <i class="fas fa-car-crash"></i> 援먰넻?ш퀬
                            </h4>
                            <div class="ref-item" onclick="applyExample('traffic1')">
                                <h5>遺二쇱쓽???묒큺?ш퀬</h5>
                                <p style="font-size: 0.8rem; color: #999;">?덉쟾嫄곕━瑜?誘명솗蹂댄븯??..</p>
                            </div>
                        </div>

                        <!-- Category: Fraud/Other -->
                        <div class="ref-category" style="margin-top: 20px;">
                            <h4
                                style="color: #aaa; margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">
                                <i class="fas fa-coins"></i> ?ш린/湲고?
                            </h4>
                            <div class="ref-item" onclick="applyExample('fraud1')">
                                <h5>湲덉쟾 梨꾨Т 遺덉씠??/h5>
                                <p style="font-size: 0.8rem; color: #999;">?쎌냽???좎쭨??蹂?쒗븯吏 紐삵빐...</p>
                            </div>
                        </div>

                        <!-- Load/Return Button -->
                        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <button class="btn btn-primary" style="width: 100%;" onclick="showWizard()">
                                <i class="fas fa-check"></i> ???댁슜?쇰줈 ?몄쭛 怨꾩냽?섍린
                            </button>
                        </div>

                    </div>
                </div>

                <!-- Right: Editor Area -->
                <div class="editor-card">
                    <div
                        style="margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <input type="text" id="docTitle" placeholder="?쒕ぉ (?먮룞 ?앹꽦?⑸땲??"
                            style="width: 70%; border:none; font-size: 1.5rem; font-weight: bold; font-family: 'Nanum Myeongjo'; outline: none; color: #333;">
                        <span style="font-size: 0.9rem; color: #999;" id="wordCount">0??/span>
                    </div>

                    <textarea class="paper-input" id="mainEditor"
                        placeholder="?쇱そ 硫붾돱?먯꽌 ?ㅼ젙???꾨즺?섍퀬 [珥덉븞 ?앹꽦?섍린]瑜??뚮윭二쇱꽭??&#13;&#10;AI媛 ?곹솴??留욌뒗 理쒖쟻???ш낵臾몄쓣 ?묒꽦?대뱶由쎈땲??"
                        oninput="updateWordCount()"></textarea>

                    <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="btn btn-glass" style="border: 1px solid #ddd; color: #666;"
                            onclick="copyToClipboard()">
                            <i class="fas fa-copy"></i> 蹂듭궗
                        </button>
                        <button class="btn btn-primary" onclick="applyAndReturn()"
                            style="background: linear-gradient(135deg, #4ade80, #22c55e); box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);">
                            <i class="fas fa-check-double"></i> 珥덉븞 ?꾩꽦: ?묒꽦 ?섏씠吏???곸슜?섍린
                        </button>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <script>
        let selectedTone = 'emotional';

        function selectTone(el, tone) {
            document.querySelectorAll('.tone-option').forEach(e => e.classList.remove('selected'));
            el.classList.add('selected');
            selectedTone = tone;
        }

        function updateWordCount() {
            const text = document.getElementById('mainEditor').value;
            document.getElementById('wordCount').innerText = text.length + '??;
        }

        // Sentence Mapping Data
        const textMap = {
            cause: {
                alcohol: "?뱀떆 ????좎뿉 痍⑦빐 ?댁꽦?곸씤 ?먮떒???대젮???곹깭??쇰ŉ,",
                anger: "?쒓컙?곸쑝濡?移섎????ㅻⅤ??媛먯젙??二쇱껜?섏? 紐삵뻽怨?",
                mistake: "?곷?諛⑹쓽 ?섎룄瑜??ㅽ빐?섍굅???곹솴???섎せ ?먮떒?섏뿬,",
                careless: "????덉씪?섍퀬 遺二쇱쓽???쒕룄濡??명빐,",
                financial: "寃쎌젣?곸쑝濡?沅곷컯???곹솴?먯꽌 ?섎せ???먮떒???대졇?쇰ŉ,"
            },
            damage: {
                physical: "?살쓣 ???녿뒗 ?좎껜??怨좏넻怨??곹빐瑜?,
                mental: "?됱깮 吏?곌린 ?섎뱺 ?뺤떊??異⑷꺽怨??몃씪?곕쭏瑜?,
                money: "媛먮떦?섍린 ?섎뱺 湲덉쟾???먯떎怨??ъ궛 ?쇳빐瑜?,
                honor: "留롮? ?щ엺???욎뿉?쒖쓽 ?섏튂?ш낵 紐낆삁 ?ㅼ텛瑜?
            },
            effort: {
                comp: "?쇳빐?먮텇猿섏꽌 ?⑸뱷?섏떎 ???덈뒗 ?섏????쇳빐 諛곗긽怨?移섎즺鍮?吏?먯쓣 ?쎌냽?쒕━硫?",
                habit: "?ㅼ떆???대윴 ?쇱씠 ?녿룄濡?湲덉＜瑜??ы븿???앺솢 ?듦???泥좎???媛쒖꽑?섍퀬,",
                counsel: "?꾨Ц?곸씤 ?щ━ ?곷떞怨?援먯쑁???댁닔?섏뿬 ???먯떊???뚯븘蹂닿퀬,",
                delete: "臾몄젣媛 ??寃뚯떆湲??利됱떆 ??젣?섍퀬 ?뺤젙臾몄쓣 寃뚯떆?섏뿬 紐낆삁 ?뚮났???꾪빐 ?몃젰?섎ŉ,"
            }
        };

        function getCheckedValues(groupId) {
            const group = document.getElementById(groupId);
            const checked = [];
            group.querySelectorAll('input:checked').forEach(input => checked.push(input.value));
            return checked;
        }

        function generateDraft() {
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ?앹꽦 以?..';
            btn.disabled = true;

            setTimeout(() => {
                const relation = document.getElementById('relationship').value;
                const causes = getCheckedValues('causeGroup');
                const damages = getCheckedValues('damageGroup');
                const efforts = getCheckedValues('effortGroup');

                let draftTitle = "吏꾩떖?쇰줈 ?ъ즲??留먯????щ┰?덈떎";

                // 1. Salutation
                const salutations = {
                    'stranger': "?좎깮?섍퍡,\n\n?쇰㈃?앸룄 ?녿뒗 ?濡??명빐 ?살쓣 ???녿뒗 ?쇳빐瑜??낆쑝???좎깮?섍퍡",
                    'acquaintance': "?덈뀞?섏떗?덇퉴, OO?낅땲??\n\n?됱냼 ?뚭퀬 吏?대뜕 ?ъ씠?꾩뿉??遺덇뎄?섍퀬 ???遺덈??ㅻ윭???됰룞?쇰줈 ???ㅻ쭩媛먯쓣 ?쒕젮",
                    'coworker': "OOO?섍퍡,\n\n?④퍡 ?쇳븯???숇즺濡쒖꽌 紐⑤쾾???섏뼱?????쒓?, ?ㅽ엳?????먮? ?쇱튂寃??섏뼱",
                    'friend': "移쒓뎄??\n\n?곕━媛 ?볦븘?붾뜕 ?곗젙???앷컖?섎㈃ ?대윴 湲???곕뒗 寃껋“李??덈Т??遺?꾨읇怨?誘몄븞??
                };
                let text = salutations[relation] + " 二꾩넚?섎떎??留먯???癒쇱? ?щ┰?덈떎.\n\n";

                // 2. Incident & Cause (Smooth Combo)
                text += "吏???ш굔 ?뱀떆, ";
                if (causes.length > 0) {
                    // Combine mapped strings
                    const causeSentences = causes.map(c => textMap.cause[c] || "").join(" ");
                    text += causeSentences + " ?뚯씠?????녿뒗 ?섎せ???吏瑜닿퀬 留먯븯?듬땲??";
                } else {
                    text += "????깆닕?섏? 紐삵븳 ?쒕룄? ?섎せ???먮떒?쇰줈 ?명빐 ???ㅼ닔瑜??吏덈??듬땲??";
                }
                text += " 洹??대뼡 蹂紐낆쑝濡쒕룄 ????됰룞???뺣떦?붾맆 ???놁쓬??堉덉?由ш쾶 ?먮겮怨?源딆씠 ?꾪쉶?섍퀬 ?덉뒿?덈떎.\n\n";

                // 3. Damage Acknowledgment
                if (damages.length > 0) {
                    text += "臾댁뾿蹂대떎 ?濡??명빐 ?쇳빐?먮떂猿섏꽌 寃れ쑝?⑥쓣 ";
                    const damageList = damages.map(d => textMap.damage[d] || "").join(" ?먰븳 ");
                    text += damageList + " ?앷컖?섎㈃, 二꾩콉媛먯뿉 怨좉컻瑜????섍? ?놁뒿?덈떎. ";
                    text += "媛?댁옄???쒓? 洹?怨좏넻??源딆씠瑜?媛먰엳 ???ㅼ븘由??섎뒗 ?녾쿋吏留? 留??쒓컙 媛??源딆씠 ?듦컧?섍퀬 ?덉뒿?덈떎.";
                } else {
                    text += "????됰룞?쇰줈 ?명빐 ?낆쑝???좊Т?뺤쓽 ?쇳빐? 留덉쓬???⑥븯???곸쿂?????源딆씠 ?ъ즲?쒕┰?덈떎.";
                }
                text += "\n\n";

                // 4. Recovery & Promise
                text += "?대? 踰뚯뼱吏??쇱쓣 ?섎룎由??섎뒗 ?녾쿋吏留? ?욎쑝濡??쒓? ?????덈뒗 紐⑤뱺 梨낆엫???ㅽ븯怨좎옄 ?⑸땲??\n";
                if (efforts.length > 0) {
                    const effortSentences = efforts.map(e => textMap.effort[e] || "").join(" ");
                    text += "?곗꽑 " + effortSentences + " ?쇳빐?먮떂???뚮났??理쒖슦?좎씠 ?????덈룄濡??쒓? ?????덈뒗 紐⑤뱺 ?몃젰???ㅽ븯寃좎뒿?덈떎.\n";
                } else {
                    text += "踰뺤쟻??梨낆엫? 臾쇰줎, ?꾩쓽?곸씤 梨낆엫源뚯? ?앷퉴吏 ?ㅽ븯寃좎뒿?덈떎.\n";
                }

                // 5. Closing
                if (selectedTone === 'emotional') {
                    text += "\n?쇳빐?먮텇猿섏꽌 寃れ쑝?⑥쓣 怨좏넻怨??먮젮???留ㅼ씪 ?앷컖?섎ŉ 諛섏꽦?섍퀬 ?덉뒿?덈떎. 遺????吏꾩떖 ?대┛ ?ш낵媛 議곌툑?대굹留??욧린瑜?媛꾩젅??湲곕룄?⑸땲??\n\n?뺣쭚 二꾩넚?⑸땲??";
                } else {
                    text += "\n諛쒖깮??紐⑤뱺 ?쇳빐??????앷퉴吏 梨낆엫??吏?寃껋씠硫? ?ㅼ떆??遺덈??ㅻ윭???쇱씠 諛쒖깮?섏? ?딅룄濡?媛곷퀎??二쇱쓽?섎ŉ ?닿쿋?듬땲??\n\n二꾩넚?⑸땲??";
                }

                document.getElementById('docTitle').value = draftTitle;
                document.getElementById('mainEditor').value = text;
                updateWordCount();

                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 1000);
        }

        function applyRef(id) {
            const textarea = document.getElementById('mainEditor');
            let textToInsert = "";

            if (id === 'ref1') textToInsert = "????쒖닚媛꾩쓽 ?섎せ???먮떒?쇰줈 ?명빐 ?살쓣 ???녿뒗 ?곸쿂瑜??쒕┛ ?? 源딆씠 諛섏꽦?섍퀬 ?덉뒿?덈떎. ";
            if (id === 'ref2') textToInsert = "移섎즺鍮??꾩븸怨??꾩옄猷뚮? ?ы븿?섏뿬 ?쇳빐?먮텇猿섏꽌 ?⑸뱷?섏떎 ???덈뒗 ?섏??쇰줈 ?쇳빐瑜?蹂?쒗븯寃좎뒿?덈떎. ";

            textarea.setRangeText(textToInsert, textarea.selectionStart, textarea.selectionEnd, 'end');
            textarea.focus();
            updateWordCount();
        }

        function copyToClipboard() {
            const copyText = document.getElementById("mainEditor");
            copyText.select();
            copyText.setSelectionRange(0, 99999);
            document.execCommand("copy");
            alert("?대┰蹂대뱶??蹂듭궗?섏뿀?듬땲??");
        }

        function confirmReturn() {
            if (confirm("?묒꽦 以묒씤 ?댁슜????λ릺吏 ?딆뒿?덈떎.\n?뺣쭚 ?ㅽ뒠?붿삤瑜??섍??쒓쿋?듬땲源?")) {
                location.href = 'apology_write.html';
            }
        }

        // New Logic: Package Draft and Deliver
        function applyAndReturn() {
            const text = document.getElementById("mainEditor").value;
            if (text.length < 10) {
                alert("?댁슜???덈Т 吏㏃뒿?덈떎. 理쒖냼 10???댁긽 ?묒꽦?댁＜?몄슂.");
                return;
            }

            if (confirm("?꾩꽦??珥덉븞???ш낵臾??묒꽦 ?섏씠吏???곸슜?섏떆寃좎뒿?덇퉴?\n(湲곗〈 ?묒꽦 ?댁슜? ?移섎맗?덈떎)")) {
                // Save to localStorage 'Packet'
                localStorage.setItem('saved_apology_text', text);

                // Redirect to standalone write page
                location.href = 'apology_write.html';
            }
        }

        // --- Navigation Logic ---
        function showWizard() {
            document.getElementById('wizardPanel').style.display = 'block';
            document.getElementById('referencePanel').style.display = 'none';

            // Sidebar Active State
            setActiveMenu('menuDraft');
        }

        function showReferences() {
            document.getElementById('wizardPanel').style.display = 'none';
            document.getElementById('referencePanel').style.display = 'block';

            // Sidebar Active State
            setActiveMenu('menuRef');
        }

        function setActiveMenu(id) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const target = document.getElementById(id);
            if (target) target.classList.add('active');

            // "Studio Home" effectively maps to Draft wizard for now
            if (id === 'menuDraft') {
                const home = document.getElementById('menuHome');
                if (home) home.classList.add('active');
            }
        }

        // --- Reference Data & Logic ---
        const exampleTexts = {
            'assault1': `[??뻾 - ?좎옄由??곕컻]
議닿꼍?섎뒗 ?쇳빐?먮떂猿?
?덈뀞?섏떗?덇퉴. 吏??X??X?? OO?먯꽌??遺덈??ㅻ윭???쇰줈 ?쇳빐?먮떂猿??살쓣 ???녿뒗 ?곸쿂瑜??낇엺 ?띻만?숈엯?덈떎.

癒쇱? ?대뼡 蹂紐낅낫?? ???誘몄꽦?숉븯怨???젰?곸씤 ?됰룞?쇰줈 ?명빐 ?≪껜?? ?뺤떊??怨좏넻??寃れ쑝?⑥쓣 ?쇳빐?먮떂猿?癒몃━ ?숈뿬 源딆씠 ?ъ즲?쒕┰?덈떎. ?좎뿉 痍⑦빐 ?곕컻?곸쑝濡??吏瑜??됰룞?댁뿀?ㅺ퀬???섎굹, ?대뒗 寃곗퐫 ?⑹꽌諛쏆쓣 ???녿뒗 ????섎せ?대ŉ, ?뱀떆 ???紐⑥뒿???덈Т??遺?꾨읇怨??꾪쉶?ㅻ읇?듬땲??

?ш굔 吏곹썑遺??吏湲덇퉴吏, ????섎せ???됰룞????몄뿉寃??쇰쭏????怨듯룷? ?쇳빐瑜?以????덈뒗吏 堉덉?由ш쾶 源⑤떕怨??덉뒿?덈떎. ?쇳빐?먮떂猿섏꽌 ?먮겮?⑥쓣 紐⑤㈇媛먭낵 異⑷꺽???앷컖?섎㈃, ?낆씠 ??媛쒕씪????留먯씠 ?놁뒿?덈떎.

?욎쑝濡??깆떎??寃쎌같 議곗궗???꾪븯?????二꾧컪???ш쾶 諛쏄쿋?듬땲?? ?먰븳, ?쇳빐?먮떂??移섎즺? ?뚮났???꾪빐 ?쒓? ?????덈뒗 紐⑤뱺 梨낆엫???ㅽ븯寃좎뒿?덈떎. ?ㅼ떆???좊줈 ?명빐 ?대윭???ㅼ닔瑜?諛섎났?섏? ?딅룄濡? 湲덉＜瑜??ы븿??紐⑤뱺 ?몃젰???ㅽ븷 寃껋쓣 ?쎌냽?쒕┰?덈떎.

遺???덇렇?ъ슫 留덉쓬?쇰줈 ????ш낵瑜?諛쏆븘二쇱떆湲?媛꾩껌?쒕━硫? ?ㅼ떆 ?쒕쾲 吏꾩떖?쇰줈 二꾩넚?⑸땲??`,

            'assault2': `[?곹빐 - ?꾩튂 諛쒖깮]
?쇳빐?먮떂猿??щ┰?덈떎.
OOO?낅땲?? ????쒖닚媛꾩쓽 ?섎せ???먮떒?쇰줈 ?명빐 ?꾩튂 X二쇱쓽 ?곹빐瑜??낆쑝?쒓퀬, 蹂묒썝 移섎즺瑜?諛쏆쑝硫?怨좏넻諛쏄퀬 怨꾩떊 ?쇳빐?먮떂???앷컖?섎㈃ 二꾩콉媛먯뿉 ?좎쓣 ?대? ?섍? ?놁뒿?덈떎.

嫄닿컯?섏뀛?????좎껜???곸쿂瑜??낇엳怨? ?쇱긽?앺솢????吏?μ쓣 ?쒕┛ ?먯뿉 ???源딆씠 諛섏꽦?섍퀬 ?덉뒿?덈떎. 臾댁뾿蹂대떎 ?????젰?곸씤 ?됰룞???쇳빐?먮떂猿??쇰쭏?????몃씪?곕쭏媛 ?섏뿀?꾩? 吏먯옉議곗감 ?섍린 ?먮졄?듬땲??

?쒓? ?吏瑜??쇱뿉 ??댁꽌??踰뺤쟻??泥섎쾶???ш쾶 諛쏄쿋?듬땲?? 洹몄? 蹂꾨룄濡? ?쇳빐?먮떂猿섏꽌 遺?댄븯??移섎즺鍮??꾩븸怨??쇱떎?섏엯, 洹몃━怨??뺤떊???꾩옄猷뚮? ?ы븿?섏뿬 ?쇳빐?먮떂猿섏꽌 ?⑸뱷?섏떎 ???덈뒗 ?섏??쇰줈 諛곗긽??寃껋쓣 ?쎌냽?쒕┰?덈떎.

?대쾲 ?쇱쓣 怨꾧린濡??щ엺???щ엺????섎뒗 ?쒕룄??????ㅼ떆 ?쒕쾲 源딆씠 ?깆같?섍퀬, ?됱깮 ?띿즲?섎뒗 留덉쓬?쇰줈 ?닿쿋?듬땲?? ?뺣쭚 二꾩넚?⑸땲??`,

            'defam1': `[紐낆삁?쇱넀 - ?낆꽦 ?볤?]
?쇳빐?먮떂猿?吏꾩떖?쇰줈 ?ъ즲?쒕┰?덈떎.
????명꽣??而ㅻ??덊떚(?먮뒗 SNS)???쇳빐?먮떂??????덉쐞 ?ъ떎怨?鍮꾨갑???볤???寃뚯떆?덈뜕 ?뱀궗?먯엯?덈떎.

?듬챸???ㅼ뿉 ?⑥뼱, 援곗쨷?щ━???⑹벝???쇳빐?먮떂猿??살쓣 ???녿뒗 ?곸쿂瑜??쒕졇?듬땲?? "?⑤뱾?????섎땲源?, "媛蹂띻쾶 ??湲?대땲源??쇰뒗 ?덉씪???앷컖???뱀궗?먯뿉寃뚮뒗 鍮꾩닔媛 ?섏뼱 苑귦옄 ???덈떎??寃껋쓣 ?ㅻ뒭寃뚯빞 堉덉?由ш쾶 源⑤떖?섏뒿?덈떎.

?묒꽦??寃뚯떆湲? 利됱떆 ??젣?섏??쇰ŉ, 而ㅻ??덊떚 愿由ъ옄?먭쾶 ?붿껌?섏뿬 愿??湲곕줉???⑥? ?딅룄濡?議곗튂?섏??듬땲?? ?섏?留??대? ?쇱쭊 留먮뱾濡??명빐 ?쇳빐?먮떂猿섏꽌 寃れ쑝???섏튂?ш낵 紐낆삁 ?ㅼ텛瑜??섎룎由????녿떎???ъ떎??留덉쓬??臾닿쾪?듬땲??

?욎쑝濡쒕뒗 ?⑤씪?몄긽?먯꽌 ??몄쓣 議댁쨷?섎ŉ, ?ㅼ떆???대윭??鍮꾧쾪???됰룞???섏? ?딄쿋?듬땲?? ???寃쎌넄???먭??쎌씠 珥덈옒??寃곌낵?????源딆씠 諛섏꽦?섎ŉ, ?쇳빐?먮떂猿??ㅼ떆 ?쒕쾲 癒몃━ ?숈뿬 ?ш낵?쒕┰?덈떎.`,

            'defam2': `[紐⑥슃 - ?⑥껜 梨꾪똿諛?
OOO?섍퍡,
吏??O??O?? ?⑥껜 梨꾪똿諛⑹뿉???쒓? OOO?섏쓣 吏移?븯硫?紐⑥슃?곸씤 ?몄궗瑜???寃껋뿉 ???源딆씠 ?ш낵?쒕┰?덈떎.

留롮? ?щ엺?ㅼ씠 ?덈뒗 怨듦컻?곸씤 怨듦컙?먯꽌, OOO?섏쓽 ?멸꺽??紐⑤룆?섍퀬 紐낆삁瑜??쇱넀?섎뒗 諛쒖뼵????寃껋? 紐낅갚??????섎せ?낅땲?? ?뱀떆 遺꾩쐞湲곗뿉 ?⑹벝???щ?濡??섏쭊 留먯씠 OOO?섍퍡 ?쇰쭏?????섏튂?ъ쓣 ?덇꺼?쒕졇?꾩? 源딆씠 ?앷컖?섏? 紐삵뻽?듬땲??

?대떦 梨꾪똿諛⑹뿉 ?덈뜕 紐⑤뱺 遺꾨뱾?먭쾶 ??諛쒖뼵???섎せ?섏뿀?뚯쓣 ?뺤젙?섍퀬 怨듦컻?곸쑝濡??ш낵?섏??듬땲?? ?섏?留??닿쾬?쇰줈 OOO?섏쓽 ?곸쿂媛 ?꾨Ъ吏 ?딆쑝由щ씪??寃껋쓣 ???뚭퀬 ?덉뒿?덈떎.

???臾대??④낵 寃쎌넄?⑥쓣 ?⑹꽌??二쇱떗?쒖삤. ?욎쑝濡쒕뒗 留먯쓽 臾닿쾶瑜?臾닿쾪寃??ш린怨? ??몄쓣 諛곕젮?섎뒗 ?щ엺???섎룄濡??몃젰?섍쿋?듬땲?? 二꾩넚?⑸땲??`,

            'traffic1': `[援먰넻?ш퀬 - ?덉쟾?댁쟾 遺덉씠??
?쇳빐?먮떂猿?
?덈뀞?섏떗?덇퉴. 吏??X??X??諛쒖깮??援먰넻?ш퀬??媛??李⑤웾 ?댁쟾??OOO?낅땲??

???遺二쇱쓽? ?덉쟾嫄곕━ 誘명솗蹂??먮뒗 ?좏샇 ?꾨컲)濡??명빐 ?ш퀬瑜??좊컻?섍퀬, ?쇳빐?먮떂???뚯쨷??李⑤웾 ?뚯넀怨??좎껜??怨좏넻??珥덈옒????吏꾩떖?쇰줈 ?ш낵?쒕┰?덈떎. 諛붿걯???쇱긽 ?以묒뿉 ? ?뚮Ц??遺덊븘?뷀븳 ?쒓컙??類뤾린怨? 蹂묒썝 移섎즺? 李⑤웾 ?섎━ ??踰덇굅濡쒖???寃れ쑝?쒓쾶 ?섏뼱 ?덈Т??二꾩넚?⑸땲??

?ш퀬 ?뱀떆 ?? 留덉쓬???쒕?濡??ш낵議곗감 ?쒕━吏 紐삵븳 寃?媛숈븘 ?대궡 留덉쓬??嫄몃졇?듬땲?? ?쇳빐?먮떂??鍮좊Ⅸ 苡뚯쑀瑜?吏꾩떖?쇰줈 湲곗썝?섎ŉ, 李⑤웾 ?섎━ 湲곌컙 ?숈븞 寃れ쑝??遺덊렪?⑥뿉 ??댁꽌???↔뎄?ㅻ윭??留덉쓬肉먯엯?덈떎.

蹂댄뿕?щ? ?듯븳 諛곗긽 泥섎━???蹂꾧컻濡? ?멸컙?곸씤 ?꾩쓽瑜??ㅽ빐 ?ш낵?쒕━怨??띠뼱 ?쒖쓣 ?ㅼ뿀?듬땲?? ?욎쑝濡쒕뒗 ?댁쟾?瑜??≪쓣 ?뚮쭏???쇳빐?먮떂???앷컖?섎ŉ, ?ㅼ떆???대윴 ?ш퀬瑜??댁? ?딅룄濡??덉쟾 ?댁쟾??留뚯쟾??湲고븯寃좎뒿?덈떎. 二꾩넚?⑸땲??`,

            'fraud1': `[?ш린/梨꾨Т遺덉씠??- 湲덉쟾 臾몄젣]
梨꾧텒??OOO?섍퍡,
?쎌냽?쒕┛ ?좎쭨??梨꾨Т瑜?蹂?쒗븯吏 紐삵븯怨? ?곕씫議곗감 ?쒕?濡??우? ?딆븘 OOO?섍퍡 湲덉쟾???먰빐? ?щ젮瑜??쇱퀜?쒕┛ ?? 源딆씠 ?ъ즲?쒕┰?덈떎.

誘욧퀬 ?덉쓣 鍮뚮젮二쇱떊 OOO?섏쓽 ?좊ː瑜??踰꾨┛ ?됰룞??????낆씠 ??媛쒕씪????留먯씠 ?놁뒿?덈떎. "怨?媛싳쓣 ???덇쿋吏"?쇰뒗 ?덉씪???앷컖?쇰줈 臾대━?섍쾶 ?먭툑???듯넻?섎떎媛 ?곹솴???낇솕?섏뿀怨? ?먮젮??留덉쓬???곕씫???쇳븯??鍮꾧쾪???됰룞源뚯? ?吏덈??듬땲?? ?대뒗 紐낅갚??????섎せ?낅땲??

?꾩옱 ????곹솴???대졄湲??섏?留? OOO?섏쓽 ?덉? ?쒓? ? ?섎젮 ?쇳빐?쒕씪??諛섎뱶???꾩븸 蹂?쒗븯寃좎뒿?덈떎. 援ъ껜?곸쑝濡쒕뒗 留ㅼ썡 X留뚯썝?? X媛쒖썡??嫄몄퀜 遺꾪븷 ?곹솚?섍퀬???섏삤?? 遺????踰덈쭔 ??湲고쉶瑜?二쇱떆湲곕? 媛꾩껌?쒕┰?덈떎.

?덈낫??以묒슂???좊ː瑜??껋? ??源딆씠 ?듦컧?섍퀬 ?덉쑝硫? ??뼱吏?붾씪??諛섎뱶???쎌냽???댄뻾?섏뿬 OOO?섍퍡 ?쇳빐媛 媛吏 ?딅룄濡?理쒖꽑???ㅽ븯寃좎뒿?덈떎. ?ㅼ떆 ?쒕쾲 怨좉컻 ?숈뿬 ?ъ즲?쒕┰?덈떎.`
        };

        function applyRef(id) {
            // Deprecated function name in some places, unifying to applyExample
            applyExample(id);
        }

        function applyExample(id) {
            let text = exampleTexts[id];
            if (!text) return;

            // Strip out the title header [Category - Title] if it exists
            // Regex matches [Anything] at the start of the string, plus following newlines
            text = text.replace(/^\[.*?\]\s*/, '');

            const textarea = document.getElementById('mainEditor');

            // Overwrite existing text
            textarea.value = text;
            textarea.scrollTop = 0; // Scroll to top

            updateWordCount();

            // Visual Feedback
            document.querySelectorAll('.ref-card').forEach(el => el.style.border = '1px solid rgba(255,255,255,0.1)');
            document.querySelector(`[onclick="applyExample('${id}')"]`)?.closest('.ref-card')?.setAttribute('style', 'border: 1px solid var(--primary) !important');
            const btn = document.querySelector(".btn-primary[onclick='applyAndReturn()']");
            // Highlight the confirm button
            btn.classList.add("btn-highlight-pulse"); // CSS animation class could be added
            alert("?좏깮?섏떊 ?덉떆臾몄씠 ?먮뵒?곗뿉 ?곸슜?섏뿀?듬땲??\n?댁슜???섏젙???? ?곗륫 ?섎떒??[珥덉븞 ?꾩꽦: ?묒꽦 ?섏씠吏???곸슜?섍린]瑜??뚮윭二쇱꽭??");
        }
    </script>
</body>

</html>